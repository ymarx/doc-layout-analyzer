# 템플릿 기반 문서 파싱 시스템 설계

## 🔍 현재 시스템 한계점 분석

### 1. 하드코딩 방식의 문제점
- **정규식 의존**: `TP-\d{3}-\d{3}-\d{3}` 같은 고정 패턴만 인식
- **유연성 부족**: 새로운 문서 형식에 대한 대응 어려움
- **확장성 제한**: 새로운 요소 추가 시 코드 수정 필요

### 2. 구조적 문제
```python
# 현재 방식 - 하드코딩된 패턴
doc_num_pattern = re.compile(r'TP-\d{3}-\d{3}-\d{3}')
date_pattern = re.compile(r'\d{2}\.\d{2}\.\d{2}')

# 문제점: 새로운 문서번호 형식이 나오면 인식 불가
```

### 3. RAG 시스템을 위한 구조적 부족
- 메타데이터와 콘텐츠 분리 불충분
- 벡터 임베딩에 적합한 청크 단위 부족
- 의미적 구조 정보 누락

## 🏗️ 개선된 시스템 아키텍처

### 1. 하이브리드 파싱 시스템
```
Template-based Parser + Pattern Recognition + Content Inference
     (고정 요소)           (구조 인식)         (내용 추론)
```

### 2. 3-tier 파싱 전략

#### Tier 1: Template-based (고정 요소)
- 문서번호, 시행일, 작성자 등 헤더 정보
- 표준 양식의 고정 위치 요소들

#### Tier 2: Pattern Recognition (구조 요소)
- 계층적 번호 체계 (1., 1.1, 1.1.1)
- 표의 행/열 구조
- 다이어그램 유형 분류

#### Tier 3: Content Inference (내용 요소)
- 자유 형식 텍스트 내용
- 표의 셀 내용
- 다이어그램 내부 텍스트

## 🔧 구현 단계별 계획

### Phase 1: 템플릿 시스템 구축 (현재 가능)
1. **문서 템플릿 정의**
   - JSON 기반 템플릿 스키마
   - 위치 기반 요소 매핑
   - 우선순위 기반 매칭

2. **다중 템플릿 매칭**
   - 템플릿 라이브러리 구축
   - 자동 템플릿 선택 알고리즘
   - 신뢰도 기반 매칭

### Phase 2: 패턴 인식 강화 (단기)
1. **구조 패턴 인식**
   - 계층 구조 자동 탐지
   - 표 구조 분석 강화
   - 다이어그램 분류 시스템

2. **어노테이션 시스템**
   - 수동 보정 인터페이스
   - 학습 데이터 생성
   - 템플릿 자동 업데이트

### Phase 3: AI 기반 추론 (중장기)
1. **경량 모델 훈련**
   - 문서 구조 분류 모델
   - 콘텐츠 유형 인식 모델
   - Few-shot 학습 적용

2. **RAG 최적화**
   - 의미적 청킹
   - 메타데이터 강화
   - 벡터 임베딩 최적화

## 📊 RAG 시스템을 위한 문서 구조

### 1. 계층적 메타데이터 구조
```json
{
  "document_metadata": {
    "template_id": "technical_standard_v1",
    "document_number": "TP-030-030-050",
    "department": "제선부",
    "process": "고로공정",
    "confidence": 0.95
  },
  "content_chunks": [
    {
      "chunk_id": "section_1_1",
      "type": "section_header",
      "hierarchy_level": 2,
      "text": "적용범위",
      "metadata": {...}
    }
  ]
}
```

### 2. 벡터 임베딩 최적화 청킹
- **Header chunks**: 메타데이터 + 제목
- **Content chunks**: 의미 단위별 내용
- **Table chunks**: 표 구조 + 내용
- **Diagram chunks**: 다이어그램 설명 + 프로세스

## 🚀 즉시 구현 가능한 개선사항

### 1. 템플릿 정의 시스템
- 현재 DocumentAnalyzer를 템플릿 기반으로 전환
- JSON 템플릿 스키마 정의
- 다중 템플릿 매칭 로직

### 2. 구조적 파싱 개선
- 계층 번호 패턴 일반화
- 표 구조 분석 강화
- 다이어그램 분류 확장

### 3. RAG 친화적 출력 형식
- 청크 단위 분할
- 메타데이터 강화
- 벡터화 최적화 구조

이를 통해 하드코딩 의존도를 줄이고, 유연한 패턴 인식이 가능한 시스템으로 발전시킬 수 있습니다.